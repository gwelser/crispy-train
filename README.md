## POC Project Documentation: Comic Book Collection Management

### 1. **Objective**
   - **Purpose**: To demonstrate the usefulness of AI in creating a project by building a simple CRUD application for managing a comic book collection.
   - **Technologies Used**: PHP 8, MySQL, PHPUnit, PDO.

### 2. **Project Overview**
   - **Application**: A CRUD application to manage comic book collections.
   - **Components**:
     - `ComicBook`: Manages comic book data.
     - `Publisher`: Manages publisher data.
     - `CreativeTeam`: Manages creative team data.
     - **Repository Pattern**: Used to interact with the database.

### 3. **Setup and Installation**

#### 3.1 **Environment Setup**
   - **PHP Version**: 8
   - **Database**: MySQL
   - **Testing Framework**: PHPUnit 11

#### 3.2 **Project Structure**
   - **`sql/`**: Conatins SQL schema definitions.
   - **`src/`**: Contains all source code.
     - **`Models/`**: Contains entity classes (`ComicBook`, `Publisher`, `CreativeTeam`).
     - **`Repositories/`**: Contains repository classes (`ComicBookRepository`, `PublisherRepository`, `CreativeTeamRepository`).
   - **`tests/`**: Contains PHPUnit test cases.
   - **`vendor/`**: Contains Composer dependencies.

#### 3.3 **Database Setup**
   - **Schema**: Define tables for `comic_books`, `publishers`, and `creative_team`.
   - **Sample SQL Schema**:
     ```sql
     CREATE TABLE comic_books (
         id INT AUTO_INCREMENT PRIMARY KEY,
         title VARCHAR(255),
         issue_number INT,
         release_date DATE,
         publisher_id INT,
         FOREIGN KEY (publisher_id) REFERENCES publishers(id)
     );
     
     CREATE TABLE publishers (
         id INT AUTO_INCREMENT PRIMARY KEY,
         name VARCHAR(255),
         country VARCHAR(255),
         established_year INT
     );
     
     CREATE TABLE creative_team (
         id INT AUTO_INCREMENT PRIMARY KEY,
         name VARCHAR(255),
         role VARCHAR(255),
         comic_book_id INT,
         FOREIGN KEY (comic_book_id) REFERENCES comic_books(id)
     );
     ```

### 4. **Implementation Details**

#### 4.1 **Models**

- **`ComicBook` Class**: Represents a comic book entity.
  - Attributes: `id`, `title`, `issueNumber`, `releaseDate`, `publisherId`
  - Methods: Getters and setters.

- **`Publisher` Class**: Represents a publisher entity.
  - Attributes: `id`, `name`, `country`, `establishedYear`
  - Methods: Getters and setters.

- **`CreativeTeam` Class**: Represents a creative team member.
  - Attributes: `id`, `name`, `role`, `comicBookId`
  - Methods: Getters and setters.

#### 4.2 **Repositories**

- **`ComicBookRepository`**:
  - Methods: `findById()`, `findAll()`, `save()`, `update()`, `delete()`
  - Uses PDO for database interactions.

- **`PublisherRepository`**:
  - Methods: `findById()`, `findAll()`, `save()`, `update()`, `delete()`
  - Uses PDO for database interactions.

- **`CreativeTeamRepository`**:
  - Methods: `findById()`, `findAll()`, `save()`, `update()`, `delete()`
  - Uses PDO for database interactions.

#### 4.3 **Testing**

- **Test Class**: `ComicBookRepositoryTest`
  - Tests: `testFindById()`, `testFindAll()`, `testSave()`, `testUpdate()`, `testDelete()`
  - Mocks: `PDO` and `PDOStatement`
  - Verifies: Correct interaction with the database and proper data handling.

- **Test Class**: `PublisherRepositoryTest`
  - Tests: `testFindById()`, `testFindAll()`, `testSave()`, `testUpdate()`, `testDelete()`
  - Mocks: `PDO` and `PDOStatement`
  - Verifies: Correct interaction with the database and proper data handling.

- **Test Class**: `CreativeTeamRepositoryTest`
  - Tests: `testFindById()`, `testFindAll()`, `testSave()`, `testUpdate()`, `testDelete()`
  - Mocks: `PDO` and `PDOStatement`
  - Verifies: Correct interaction with the database and proper data handling.

### 5. **Challenges and Resolutions**

#### 5.1 **Handling Deprecated Methods**

Updating the PHPUnit test methods to handle deprecated methods involved a detailed and iterative process. Initially, the unit tests generated by AI used methods that had been deprecated or removed in PHPUnit v11, despite clear instructions to use the latest version. Hereâ€™s a summary of how the process unfolded:

- **Initial Test Generation:**
   - The AI initially generated unit tests using PHPUnit methods like `withConsecutive()`, `returnCallback()`, and `at()`, which were either deprecated or removed in PHPUnit v11.

- **Error Identification:**
   - After running the initial tests, errors related to these deprecated methods were identified. For example, `withConsecutive()` and `returnCallback()` were no longer available, and the `at()` method had been removed.

- **Error Reporting and AI Guidance:**
   - To address these issues, I reported the specific error messages to the AI. Providing the exact error messages was crucial in guiding the AI towards the necessary updates.
   - For instance, I mentioned errors like `Call to undefined method ComicBookRepositoryTest::at()` to the AI.
   - In an early iteration, the AI response used several consectively stacked `with()` calls resulting in the error `PHPUnit\Framework\MockObject\MethodParametersAlreadyConfiguredException`.

- **Updating Test Methods:**
   - I instructed the AI to replace deprecated methods with their current alternatives. For `withConsecutive()`, I suggested using `willReturn()` with multiple `willReturn()` calls. For `returnCallback()`, I advised using `willReturnCallback()`. The `at()` method was replaced with explicit call verification.

- **Iterative Refinement:**
   - The process involved multiple iterations. Each time an error was addressed, the updated tests were re-run. New errors or issues were then reported to the AI, and adjustments were made accordingly.
   - This iterative approach was essential for refining the test methods to ensure compatibility with PHPUnit v11.

- **Final Validation:**
   - After several rounds of updates and refinements, the tests were successfully updated to work with PHPUnit v11, avoiding all deprecated methods and passing as expected.

By detailing the errors and specifying the methods that were deprecated or removed, the process ensured that the tests were compatible with the latest PHPUnit version. This approach was instrumental in achieving passing unit tests and successfully completing the project.

#### 5.2 **Mocking PDO** 

- **Simulate Database Operations**
   - Used `PDOStatement` mocks to simulate database operations and validate repository methods.

### 6. **Future Enhancements**

- **Expand Functionality**: Add additional features such as search and filtering.
- **Improve Testing**: Include integration tests and more edge cases.

### 7. **Conclusion**
   - Successfully demonstrated the usefulness of AI in project creation and unit testing.
   - The project serves as a practical example of AI-driven development.

---

## PHPUnit
Run unit tests with HTML code coverage report: `composer phpunit`